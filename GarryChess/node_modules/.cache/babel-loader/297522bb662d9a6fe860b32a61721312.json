{"ast":null,"code":"import { Chess } from 'chess.js';\n\nconst axios = require('axios');\n\nexport async function getBestMove(rootPos) {\n  let rootFenCleaned = rootPos.split(' ').slice(0, 3).join(' ');\n  let response = await axios.get('https://lichess.org/api/cloud-eval', {\n    params: {\n      fen: rootFenCleaned\n    }\n  });\n  let result = response.data.pvs[0].moves.split(\" \")[0];\n  return result;\n}\nexport async function getELOspecificMoves(rootPos, elo) {\n  let rootFenCleaned = rootPos.split(' ').slice(0, 3).join(' ');\n  let response = await axios.get('https://explorer.lichess.ovh/lichess', {\n    params: {\n      fen: rootFenCleaned,\n      speed: 'blitz',\n      moves: 3,\n      ratings: [elo - 50, elo + 50]\n    }\n  });\n  let numMoves = response.data.moves.length;\n  let result = [response.data.moves[0].uci];\n  if (numMoves > 1) result.push(response.data.moves[1].uci);\n  if (numMoves > 2) result.push(response.data.moves[2].uci);\n  return result;\n}\nexport async function generatePositions(rootPos, color, eloLevel) {\n  let game = new Chess(rootPos);\n  let allPositions = [];\n  let positions = [rootPos];\n  let newPositions = [];\n\n  if (game.turn() === color) {\n    allPositions.push(rootPos);\n  }\n\n  for (let i = 0; i < 5; i++) {\n    for (let position of positions) {\n      game.load(position);\n\n      if (game.turn() === color) {\n        game.load(position);\n        let move = await getBestMove(position);\n        game.move({\n          from: move.slice(0, 2),\n          to: move.slice(2, 4)\n        });\n        newPositions.push(game.fen());\n      } else {\n        let moves = await getELOspecificMoves(position, eloLevel);\n\n        for (let move of moves) {\n          game.load(position);\n          game.move({\n            from: move.slice(0, 2),\n            to: move.slice(2, 4)\n          });\n          newPositions.push(game.fen());\n          allPositions.push(game.fen());\n        }\n      }\n    }\n\n    positions = newPositions;\n    newPositions = [];\n  }\n\n  return allPositions;\n} // move is assumed to be valid\n\nfunction cleanBestMove(game, move) {\n  if (move.slice(0, 2) === 'e1' && game.get('e1').piece === 'k' && game.get('e1').color === 'w' && move.slice(2, 4) === 'h1') {\n    return 'e1g1';\n  } else if (move.slice(0, 2) === 'e1' && game.get('e1').piece === 'k' && game.get('e1').color === 'w' && move.slice(2, 4) === 'a1') {\n    return 'e1c1';\n  } else if (move.slice(0, 2) === 'e8' && game.get('e8').piece === 'k' && game.get('e8').color === 'b' && move.slice(2, 4) === 'h8') {\n    return 'e8g8';\n  } else if (move.slice(0, 2) === 'e8' && game.get('e8').piece === 'k' && game.get('e1').color === 'b' && move.slice(2, 4) === 'a8') {\n    return 'e8c8';\n  }\n\n  return move;\n}","map":{"version":3,"names":["Chess","axios","require","getBestMove","rootPos","rootFenCleaned","split","slice","join","response","get","params","fen","result","data","pvs","moves","getELOspecificMoves","elo","speed","ratings","numMoves","length","uci","push","generatePositions","color","eloLevel","game","allPositions","positions","newPositions","turn","i","position","load","move","from","to","cleanBestMove","piece"],"sources":["/Users/kianeghbalnia/Desktop/garry-chess/GarryChess/src/ImportantFunctions.js"],"sourcesContent":["import { Chess } from 'chess.js';\n\nconst axios = require('axios');\n\nexport async function getBestMove(rootPos) {\n    let rootFenCleaned = rootPos.split(' ').slice(0,3).join(' ');\n    let response = await axios.get('https://lichess.org/api/cloud-eval', {\n        params: {\n          fen: rootFenCleaned\n        }\n      });\n    let result = response.data.pvs[0].moves.split(\" \")[0];\n    return result;\n}\n\nexport async function getELOspecificMoves(rootPos, elo){\n    let rootFenCleaned = rootPos.split(' ').slice(0,3).join(' ');\n    let response = await axios.get('https://explorer.lichess.ovh/lichess', {\n        params: {\n          fen: rootFenCleaned,\n          speed: 'blitz',\n          moves: 3,\n          ratings: [elo-50, elo+50],\n        }\n      });\n    let numMoves = response.data.moves.length;\n    let result = [response.data.moves[0].uci];\n    if (numMoves > 1)\n      result.push(response.data.moves[1].uci);\n    if (numMoves > 2)\n      result.push(response.data.moves[2].uci);\n    return result;\n}\n\nexport async function generatePositions(rootPos, color, eloLevel) {\n    let game = new Chess(rootPos);\n    let allPositions = [];\n\n    let positions = [rootPos];\n    let newPositions = [];\n\n    if (game.turn() === color){\n      allPositions.push(rootPos);\n    }\n    for (let i = 0; i<5; i++)\n    {\n      for (let position of positions)\n      {\n        game.load(position);\n        \n        if (game.turn() === color){\n          game.load(position);\n          let move = await getBestMove(position);\n          game.move({ from: move.slice(0,2), to: move.slice(2,4) });\n          newPositions.push(game.fen());\n        }else {\n          let moves = await getELOspecificMoves(position, eloLevel);\n          for (let move of moves)\n          {\n            game.load(position);\n            game.move({ from: move.slice(0,2), to: move.slice(2,4) });\n            newPositions.push(game.fen());\n            allPositions.push(game.fen());\n          }\n        }\n      }\n      positions = newPositions;\n      newPositions = [];\n    }\n    return allPositions;\n}\n // move is assumed to be valid\nfunction cleanBestMove(game, move){\n  if (move.slice(0,2) === 'e1' && game.get('e1').piece === 'k' && game.get('e1').color === 'w' && move.slice(2,4) === 'h1'){\n    return 'e1g1'\n  }\n  else if (move.slice(0,2) === 'e1' && game.get('e1').piece === 'k' && game.get('e1').color === 'w' && move.slice(2,4) === 'a1'){\n    return 'e1c1'\n  }\n  else if (move.slice(0,2) === 'e8' && game.get('e8').piece === 'k' && game.get('e8').color === 'b' && move.slice(2,4) === 'h8'){\n    return 'e8g8'\n  }\n  else if (move.slice(0,2) === 'e8' && game.get('e8').piece === 'k' && game.get('e1').color === 'b' && move.slice(2,4) === 'a8'){\n    return 'e8c8'\n  }\n  return move;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}