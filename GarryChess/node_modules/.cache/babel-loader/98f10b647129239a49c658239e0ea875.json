{"ast":null,"code":"import { Chess } from 'chess.js';\n\nconst axios = require('axios');\n\nexport async function getBestMove(rootPos) {\n  let rootFenCleaned = rootPos.split(' ').slice(0, 3).join(' ');\n  let response = await axios.get('https://lichess.org/api/cloud-eval', {\n    params: {\n      fen: rootFenCleaned\n    }\n  });\n  let result = response.data.pvs[0].moves.split(\" \")[0];\n  return cleanBestMove(result);\n}\nexport async function getELOspecificMoves(rootPos, elo) {\n  let rootFenCleaned = rootPos.split(' ').slice(0, 3).join(' ');\n  let response = await axios.get('https://explorer.lichess.ovh/lichess', {\n    params: {\n      fen: rootFenCleaned,\n      speed: 'blitz',\n      moves: 3,\n      ratings: [elo - 50, elo + 50]\n    }\n  });\n  let numMoves = response.data.moves.length;\n  let result = [response.data.moves[0].uci];\n  if (numMoves > 1) result.push(response.data.moves[1].uci);\n  if (numMoves > 2) result.push(response.data.moves[2].uci);\n  return result.map(move => cleanBestMove(move));\n}\nexport async function generatePositions(rootPos, color, eloLevel) {\n  let game = new Chess(rootPos);\n  let allPositions = [];\n  let positions = [rootPos];\n  let newPositions = [];\n\n  if (game.turn() === color) {\n    allPositions.push(rootPos);\n  }\n\n  for (let i = 0; i < 5; i++) {\n    for (let position of positions) {\n      game.load(position);\n\n      if (game.turn() === color) {\n        game.load(position);\n        let move = await getBestMove(position);\n        game.move({\n          from: move.slice(0, 2),\n          to: move.slice(2, 4)\n        });\n        newPositions.push(game.fen());\n      } else {\n        let moves = await getELOspecificMoves(position, eloLevel);\n\n        for (let move of moves) {\n          game.load(position);\n          game.move({\n            from: move.slice(0, 2),\n            to: move.slice(2, 4)\n          });\n          newPositions.push(game.fen());\n          allPositions.push(game.fen());\n        }\n      }\n    }\n\n    positions = newPositions;\n    newPositions = [];\n  }\n\n  return allPositions;\n} // move is assumed to be valid\n\nfunction cleanBestMove(game, move) {\n  if (move.slice(0, 2) === 'e1' && game.get('e1').piece === 'k' && game.get('e1').color === 'w' && move.slice(2, 4) === 'h1') {\n    return 'e1g1';\n  } else if (move.slice(0, 2) === 'e1' && game.get('e1').piece === 'k' && game.get('e1').color === 'w' && move.slice(2, 4) === 'a1') {\n    return 'e1c1';\n  } else if (move.slice(0, 2) === 'e8' && game.get('e8').piece === 'k' && game.get('e8').color === 'b' && move.slice(2, 4) === 'h8') {\n    return 'e8g8';\n  } else if (move.slice(0, 2) === 'e8' && game.get('e8').piece === 'k' && game.get('e1').color === 'b' && move.slice(2, 4) === 'a8') {\n    return 'e8c8';\n  }\n\n  return move;\n}","map":{"version":3,"names":["Chess","axios","require","getBestMove","rootPos","rootFenCleaned","split","slice","join","response","get","params","fen","result","data","pvs","moves","cleanBestMove","getELOspecificMoves","elo","speed","ratings","numMoves","length","uci","push","map","move","generatePositions","color","eloLevel","game","allPositions","positions","newPositions","turn","i","position","load","from","to","piece"],"sources":["/Users/kianeghbalnia/Desktop/garry-chess/GarryChess/src/ImportantFunctions.js"],"sourcesContent":["import { Chess } from 'chess.js';\n\nconst axios = require('axios');\n\nexport async function getBestMove(rootPos) {\n    let rootFenCleaned = rootPos.split(' ').slice(0,3).join(' ');\n    let response = await axios.get('https://lichess.org/api/cloud-eval', {\n        params: {\n          fen: rootFenCleaned\n        }\n      });\n    let result = response.data.pvs[0].moves.split(\" \")[0];\n    return cleanBestMove(result);\n}\n\nexport async function getELOspecificMoves(rootPos, elo){\n    let rootFenCleaned = rootPos.split(' ').slice(0,3).join(' ');\n    let response = await axios.get('https://explorer.lichess.ovh/lichess', {\n        params: {\n          fen: rootFenCleaned,\n          speed: 'blitz',\n          moves: 3,\n          ratings: [elo-50, elo+50],\n        }\n      });\n    let numMoves = response.data.moves.length;\n    let result = [response.data.moves[0].uci];\n    if (numMoves > 1)\n      result.push(response.data.moves[1].uci);\n    if (numMoves > 2)\n      result.push(response.data.moves[2].uci);\n    return result.map((move)=>cleanBestMove(move));\n}\n\nexport async function generatePositions(rootPos, color, eloLevel) {\n    let game = new Chess(rootPos);\n    let allPositions = [];\n\n    let positions = [rootPos];\n    let newPositions = [];\n\n    if (game.turn() === color){\n      allPositions.push(rootPos);\n    }\n    for (let i = 0; i<5; i++)\n    {\n      for (let position of positions)\n      {\n        game.load(position);\n        \n        if (game.turn() === color){\n          game.load(position);\n          let move = await getBestMove(position);\n          game.move({ from: move.slice(0,2), to: move.slice(2,4) });\n          newPositions.push(game.fen());\n        }else {\n          let moves = await getELOspecificMoves(position, eloLevel);\n          for (let move of moves)\n          {\n            game.load(position);\n            game.move({ from: move.slice(0,2), to: move.slice(2,4) });\n            newPositions.push(game.fen());\n            allPositions.push(game.fen());\n          }\n        }\n      }\n      positions = newPositions;\n      newPositions = [];\n    }\n    return allPositions;\n}\n\n// move is assumed to be valid\nfunction cleanBestMove(game, move){\n  if (move.slice(0,2) === 'e1' && game.get('e1').piece === 'k' && game.get('e1').color === 'w' && move.slice(2,4) === 'h1'){\n    return 'e1g1'\n  }\n  else if (move.slice(0,2) === 'e1' && game.get('e1').piece === 'k' && game.get('e1').color === 'w' && move.slice(2,4) === 'a1'){\n    return 'e1c1'\n  }\n  else if (move.slice(0,2) === 'e8' && game.get('e8').piece === 'k' && game.get('e8').color === 'b' && move.slice(2,4) === 'h8'){\n    return 'e8g8'\n  }\n  else if (move.slice(0,2) === 'e8' && game.get('e8').piece === 'k' && game.get('e1').color === 'b' && move.slice(2,4) === 'a8'){\n    return 'e8c8'\n  }\n  return move;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}